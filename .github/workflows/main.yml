name: Discord Notifications

on:
  push:
    branches:
      - main
  pull_request:
    types: [opened, closed, reopened]
  issues:
    types: [opened, closed, reopened]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Determine Event Message
        id: event_message
        run: |
          if [[ "${{ github.event_name }}" == "push" ]]; then
            echo "::set-output name=message::üì• New push to repository: ${{ github.repository }}"
          elif [[ "${{ github.event_name }}" == "pull_request" ]]; then
            echo "::set-output name=message::üîÄ Pull request ${{ github.event.action }}: ${{ github.event.pull_request.title }}"
          elif [[ "${{ github.event_name }}" == "issues" ]]; then
            echo "::set-output name=message::‚ö†Ô∏è Issue ${{ github.event.action }}: ${{ github.event.issue.title }}"
          else
            echo "::set-output name=message::‚ÑπÔ∏è Event '${{ github.event_name }}' occurred in repository: ${{ github.repository }}"
          fi

      - name: Send Discord Notification
        uses: Ilshidur/action-discord@master
        with:
          args: |
            {
              "embeds": [
                {
                  "title": "Repository Update",
                  "description": "${{ steps.event_message.outputs.message }}",
                  "color": 5814783,
                  "fields": [
                    {
                      "name": "Triggered By",
                      "value": "${{ github.actor }}",
                      "inline": true
                    },
                    {
                      "name": "Repository",
                      "value": "${{ github.repository }}",
                      "inline": true
                    }
                  ],
                  "footer": {
                    "text": "GitHub Actions"
                  },
                  "timestamp": "${{ github.event.repository.updated_at }}"
                }
              ]
            }
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
